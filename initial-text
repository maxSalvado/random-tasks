h1. üìò Documenta√ß√£o do Fluxo Power Automate: Gerenciamento de Incidentes

h2. Vis√£o Geral

Este documento descreve a estrutura, l√≥gica e objetivos do fluxo automatizado criado no *Microsoft Power Automate*, cuja miss√£o √© conectar diferentes servi√ßos do Microsoft 365 para orquestrar a√ß√µes a partir de requisi√ß√µes feitas por um aplicativo desenvolvido no *Microsoft Power Apps*.

O prop√≥sito principal do fluxo √© receber informa√ß√µes de incidentes inicialmente registrados na plataforma *ServiceNow*, processar e armazenar essas informa√ß√µes no *SharePoint*, identificar stakeholders e equipes de seguran√ßa, e enviar notifica√ß√µes autom√°ticas por meio do *Microsoft Teams*.

h2. üîÅ Gatilho de In√≠cio

* O fluxo √© iniciado por uma requisi√ß√£o recebida a partir de um aplicativo no *Microsoft Power Apps*, que envia uma s√©rie de vari√°veis listadas abaixo:
  - itemID [number]
  - function [string]
  - ticketNumber [string]
  - clientName [string]
  - shortDescription [string]
  - longDescription [string]
  - update [string]
  - clientID [string]
  - stakeholders [string]
  - notificationGroup [string]
  - teams [boolean]
  - push [boolean]
  - criticality [string]
  - techlead [string]
  - iscrisis [boolean]

h2. üì• Etapas de Coleta e Enriquecimento de Dados

# Consulta em uma lista do *SharePoint* para recuperar os _"Recipientes de Seguran√ßa da Informa√ß√£o"_.
# Para cada pessoa recuperada, √© feita uma chamada ao conector do *Office 365* para obten√ß√£o do perfil completo. Os dados s√£o armazenados em um array chamada *Recipientes*.
# A vari√°vel *stakeholders*, enviada pela aplica√ß√£o, √© percorrida e seus itens tamb√©m s√£o adicionados a array *Recipientes*.
# Uma chamada a um *fluxo filho* chamado "Child-GetStakeholders" √© realizada. Este fluxo consulta a API da aplica√ß√£o *Apollo* para obter stakeholders adicionais, que tamb√©m passam por enriquecimento via *Office 365* antes de serem adicionados a array *Recipientes*.

h2. üîÄ Tomada de Decis√£o (Switch Function)

O fluxo utiliza uma estrutura *switch* para tratar diferentes opera√ß√µes baseadas no valor da vari√°vel *@function*@ enviada pelo Power Apps:

h3. *function = "Open"*
* Um novo item √© criado na lista *Incident History* no SharePoint.
* Caso a vari√°vel *@push@* seja verdadeira, uma notifica√ß√£o *push* √© enviada ao aplicativo Power Apps.
* A seguir, realiza-se a [Valida√ß√£o de Canais].

h3. *function = "Update"*
* Um item existente (localizado via *@ItemId@*) na lista *Incident History* √© atualizado com os novos dados.
* O status √© alterado para _In Progress_.
* Notifica√ß√µes *push* e a [Valida√ß√£o de Canais] s√£o realizadas conforme aplic√°vel.

h3. *function = "Close"*
* O item correspondente √© atualizado com status _Resolved_.
* Notifica√ß√µes *push* e [Valida√ß√£o de Canais].

h3. *function = "Reopen"*
* O item √© atualizado com status _In Progress_.
* Notifica√ß√µes *push* e [Valida√ß√£o de Canais].

h3. *function = "Monitoring"*
* O item √© atualizado com status _Monitoring_ ap√≥s o envio da notifica√ß√£o *push*.
* A [Valida√ß√£o de Canais] tamb√©m √© realizada.

h3. *function = "Test"*
* Este caso √© utilizado apenas em ambientes de desenvolvimento/testes.
* Uma mensagem √© enviada ao canal *Incident Communication Test Team* no Teams.
* Um item √© criado na lista *Incident History QA* com os dados enviados.

h2. üì£ Valida√ß√£o de Canais (NotificationGroup)

A vari√°vel *@NotificationGroup@* define o canal do *Microsoft Teams* que deve receber uma notifica√ß√£o sobre o incidente:

|| NotificationGroup || Time do Teams || Canal ||
| Seguran√ßa da Informa√ß√£o | [NTT] Incidentes de Seguran√ßa da Informa√ß√£o | Notifica√ß√µes Incidentes Seguran√ßa da Informa√ß√£o |
| LATAM Service BR | [NTT] MS + CMD | Notifica√ß√µes P1 Services |
| SOC LATAM | [NTT] SOC LATAM | Notifica√ß√µes P1 SOC |
| SOC Americas | AM.US-Queue Management | Brazil SOC Major Incident Chat (MIM) |
| Cloud | [NTT] CLOUD | Notifica√ß√µes P1 CLOUD |
| Chile | [NTT] Notifica√ß√µes P1 ‚Äì Chile | Notifica√ß√µes P1 P2 CHILE |

h2. ‚òéÔ∏è Notifica√ß√µes em Caso de Crise

Se a vari√°vel *@iscrisis@* for verdadeira e a fun√ß√£o for *Open* ou *Test*:

* A lista *@varEmailListToCrisis@* √© populada com os e-mails dos stakeholders e do engenheiro respons√°vel pelo incidente.
* Cada e-mail √© transformado em um ID de usu√°rio via conector do *Office 365*.
* Um chat no *Microsoft Teams* √© criado com todos os IDs da lista *varUsersIdsToCrisisChat*.
* Uma mensagem estilizada √© enviada com os seguintes campos:
  - Cliente
  - Ticket number
  - Gravidade
  - Descri√ß√£o
  - Engenheiro respons√°vel
  - Status

h2. üß™ Tratamento de Erros

Todo o processo descrito √© encapsulado em um bloco *try*. Se qualquer erro ocorrer:

* Um bloco *catch* envia uma notifica√ß√£o para o time *InternalApps Errors* no canal *General* do *Microsoft Teams*.
* Dessa forma, o time respons√°vel pode intervir manualmente para investigar e corrigir a falha.

h2. ‚úÖ Conclus√£o

Esse fluxo √© um exemplo robusto de como integrar m√∫ltiplas plataformas do ecossistema Microsoft 365 com prop√≥sito claro, l√≥gica bem definida e automa√ß√£o inteligente. Ele garante que os incidentes sejam corretamente tratados, registrados e comunicados, promovendo agilidade e organiza√ß√£o no processo de resposta a eventos cr√≠ticos.

Se voc√™ chegou at√© aqui: parab√©ns! Agora voc√™ tamb√©m entende como esse fluxo funciona ‚Äì e, quem sabe, ele at√© ficou mais simp√°tico depois dessa leitura üòâ
